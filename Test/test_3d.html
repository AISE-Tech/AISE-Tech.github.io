<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Visualizaci√≥n Robot 3D</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
            background-color: #222;
            color: white;
        }
        
        #robot-3d-section {
            text-align: center;
            padding: 20px;
            background: #222;
            color: white;
        }
        
        #robot-3d-container {
            width: 100vw;
            max-width: 100%;
            height: 500px;
            margin: 0 auto;
            background: #181c24;
            border-top: 2px solid #00bcd4;
            border-bottom: 2px solid #00bcd4;
            box-sizing: border-box;
            position: relative;
            z-index: 1;
        }
        
        @media (max-width: 600px) {
            #robot-3d-container { height: 300px; }
        }
        
        #debug-info {
            position: absolute;
            bottom: 10px;
            left: 10px;
            background: rgba(0,0,0,0.7);
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            z-index: 100;
            max-width: 80%;
            overflow: auto;
        }
    </style>
    
    <!-- Importaci√≥n de bibliotecas Three.js en el head -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r132/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.0/examples/js/loaders/GLTFLoader.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.0/examples/js/controls/OrbitControls.min.js"></script>
</head>
<body>
    <!-- Secci√≥n del robot 3D -->
    <section id="robot-3d-section">
        <h2>Visualizaci√≥n del Robot en 3D</h2>
        <div id="robot-3d-container" data-model-url="robot_model.glb"></div>
        <div id="debug-info"></div>
    </section>

    <!-- Script para la visualizaci√≥n del robot -->
    <script>
        // Funci√≥n para mostrar informaci√≥n de depuraci√≥n
        function logDebug(message) {
            const debugElement = document.getElementById('debug-info');
            if (debugElement) {
                const time = new Date().toLocaleTimeString();
                debugElement.innerHTML += `<div>[${time}] ${message}</div>`;
                console.log(message);
            }
        }

        // Funci√≥n para comprobar si THREE est√° disponible
        function checkThreeJS() {
            if (typeof THREE === 'undefined') {
                logDebug("‚ùå ERROR: THREE.js no est√° cargado correctamente");
                return false;
            } else {
                logDebug("‚úÖ THREE.js cargado correctamente (versi√≥n: " + THREE.REVISION + ")");
                
                if (typeof THREE.GLTFLoader === 'undefined') {
                    logDebug("‚ùå ERROR: GLTFLoader no est√° disponible");
                    return false;
                } else {
                    logDebug("‚úÖ GLTFLoader disponible");
                }
                
                if (typeof THREE.OrbitControls === 'undefined') {
                    logDebug("‚ùå ERROR: OrbitControls no est√° disponible");
                    return false;
                } else {
                    logDebug("‚úÖ OrbitControls disponible");
                }
                
                return true;
            }
        }

        // Funci√≥n principal de inicializaci√≥n
        function init3DViewer() {
            logDebug("üîÑ Iniciando configuraci√≥n de visualizador 3D...");
            
            // Comprobar THREE.js
            if (!checkThreeJS()) {
                return;
            }
            
            const container = document.getElementById('robot-3d-container');
            if (!container) {
                logDebug("‚ùå ERROR: No se encontr√≥ el contenedor #robot-3d-container");
                return;
            }
            
            // Obtener URL del modelo
            const MODEL_URL = container.dataset.modelUrl;
            logDebug("üìÅ URL del modelo: " + MODEL_URL);
            
            // Crear escena
            const scene = new THREE.Scene();
            scene.background = new THREE.Color(0x181c24);
            logDebug("‚úÖ Escena creada");
            
            // Configurar dimensiones
            const width = container.clientWidth;
            const height = container.clientHeight;
            logDebug(`üìè Dimensiones: ${width}x${height}`);
            
            // Configurar c√°mara
            const camera = new THREE.PerspectiveCamera(45, width / height, 0.1, 1000);
            camera.position.set(0, 2, 5);
            logDebug("‚úÖ C√°mara configurada");
            
            // Configurar renderer
            const renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(width, height);
            renderer.setPixelRatio(window.devicePixelRatio);
            container.appendChild(renderer.domElement);
            logDebug("‚úÖ Renderer creado y a√±adido al DOM");
            
            // A√±adir controles
            const controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.target.set(0, 0, 0);
            controls.update();
            logDebug("‚úÖ Controles de c√°mara a√±adidos");
            
            // A√±adir luces
            scene.add(new THREE.AmbientLight(0xffffff, 0.7));
            const dirLight = new THREE.DirectionalLight(0xffffff, 0.8);
            dirLight.position.set(5, 10, 7.5);
            scene.add(dirLight);
            logDebug("‚úÖ Luces a√±adidas a la escena");
            
            // A√±adir rejilla para referencia visual
            const gridHelper = new THREE.GridHelper(10, 10);
            scene.add(gridHelper);
            logDebug("‚úÖ Rejilla de ayuda a√±adida");
            
            // Crear un cubo peque√±o para referencia visual inmediata
            const cubeGeometry = new THREE.BoxGeometry(0.5, 0.5, 0.5);
            const cubeMaterial = new THREE.MeshBasicMaterial({ color: 0x00bcd4, wireframe: true });
            const cube = new THREE.Mesh(cubeGeometry, cubeMaterial);
            scene.add(cube);
            logDebug("‚úÖ Cubo de referencia a√±adido");
            
            // Funci√≥n de animaci√≥n
            function animate() {
                requestAnimationFrame(animate);
                cube.rotation.y += 0.01;
                controls.update();
                renderer.render(scene, camera);
            }
            
            // Iniciar animaci√≥n
            animate();
            logDebug("‚úÖ Animaci√≥n iniciada");
            
            // Cargar modelo 3D
            logDebug("üîÑ Intentando cargar modelo desde: " + MODEL_URL);
            
            try {
                const loader = new THREE.GLTFLoader();
                
                loader.load(
                    MODEL_URL,
                    function(gltf) {
                        logDebug("‚úÖ Modelo cargado correctamente");
                        const model = gltf.scene;
                        
                        // Centrar y escalar el modelo
                        const box = new THREE.Box3().setFromObject(model);
                        const center = box.getCenter(new THREE.Vector3());
                        const size = box.getSize(new THREE.Vector3());
                        
                        const maxDim = Math.max(size.x, size.y, size.z);
                        const scale = 2 / maxDim;
                        model.scale.set(scale, scale, scale);
                        
                        model.position.x = -center.x * scale;
                        model.position.y = -center.y * scale;
                        model.position.z = -center.z * scale;
                        
                        // Remover el cubo de referencia cuando el modelo est√° cargado
                        scene.remove(cube);
                        
                        // A√±adir el modelo a la escena
                        scene.add(model);
                        logDebug("‚úÖ Modelo a√±adido a la escena");
                    },
                    function(xhr) {
                        const percent = xhr.loaded / xhr.total * 100;
                        logDebug(`üîÑ Cargando: ${percent.toFixed(2)}%`);
                    },
                    function(error) {
                        logDebug("‚ùå ERROR cargando el modelo: " + error.message);
                        // El cubo azul permanecer√° visible como referencia si el modelo no carga
                    }
                );
            } catch (error) {
                logDebug("‚ùå ERROR al crear loader: " + error.message);
            }
            
            // Manejar redimensionamiento
            window.addEventListener('resize', function() {
                const w = container.clientWidth;
                const h = container.clientHeight;
                camera.aspect = w / h;
                camera.updateProjectionMatrix();
                renderer.setSize(w, h);
                logDebug(`üìè Redimensionado a: ${w}x${h}`);
            });
        }

        // Ejecutar cuando el DOM est√© listo
        document.addEventListener("DOMContentLoaded", function() {
            logDebug("üöÄ DOM cargado, iniciando visualizador 3D");
            init3DViewer();
        });
    </script>
</body>
</html>